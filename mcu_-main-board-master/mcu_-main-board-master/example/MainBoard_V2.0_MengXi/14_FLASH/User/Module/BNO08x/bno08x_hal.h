#ifndef __BNO08X_HAL_H_
#define __BNO08X_HAL_H_

#include "MyDefine.h"  // STM32 HAL????????????????MCU??????????stm32f1xx_hal.h??

/** @defgroup BNO080_Constants BNO080????????
  * @{
  */

/** ???I2C?????BNO080???0x4A??0x4B????ADR??????? */
#define BNO080_DEFAULT_ADDRESS 0x4B

/** I2C?????????????????δ???????? */
#define I2C_BUFFER_LENGTH 32

/** ??????????С??SHTPЭ?E??????? */
#define MAX_PACKET_SIZE 128

/** FRS????????? */
#define MAX_METADATA_SIZE 9

/** SHTP??????? */
#define CHANNEL_COMMAND         0  // ???????
#define CHANNEL_EXECUTABLE      1  // ????????
#define CHANNEL_CONTROL         2  // ???????
#define CHANNEL_REPORTS         3  // ???????
#define CHANNEL_WAKE_REPORTS    4  // ??????????
#define CHANNEL_GYRO            5  // ?????????

/** SHTP????ID */
#define SHTP_REPORT_COMMAND_RESPONSE      0xF1  // ???????
#define SHTP_REPORT_COMMAND_REQUEST       0xF2  // ????????
#define SHTP_REPORT_FRS_READ_RESPONSE     0xF3  // FRS??????
#define SHTP_REPORT_FRS_READ_REQUEST      0xF4  // FRS???????
#define SHTP_REPORT_PRODUCT_ID_RESPONSE   0xF8  // ???ID???
#define SHTP_REPORT_PRODUCT_ID_REQUEST    0xF9  // ???ID????
#define SHTP_REPORT_BASE_TIMESTAMP        0xFB  // ????????
#define SHTP_REPORT_SET_FEATURE_COMMAND   0xFD  // ????????????

/** ??????????ID */
#define SENSOR_REPORTID_ACCELEROMETER            0x01  // ??????
#define SENSOR_REPORTID_GYROSCOPE                0x02  // ??????
#define SENSOR_REPORTID_MAGNETIC_FIELD           0x03  // ??????
#define SENSOR_REPORTID_LINEAR_ACCELERATION      0x04  // ????????
#define SENSOR_REPORTID_ROTATION_VECTOR          0x05  // ???????
#define SENSOR_REPORTID_GRAVITY                  0x06  // ????
#define SENSOR_REPORTID_GAME_ROTATION_VECTOR     0x08  // ??????????
#define SENSOR_REPORTID_GEOMAGNETIC_ROTATION_VECTOR 0x09  // ??????????
#define SENSOR_REPORTID_TAP_DETECTOR             0x10  // ??????
#define SENSOR_REPORTID_STEP_COUNTER             0x11  // ??????????
#define SENSOR_REPORTID_STABILITY_CLASSIFIER     0x13  // ??????????
#define SENSOR_REPORTID_PERSONAL_ACTIVITY_CLASSIFIER 0x1E  // ???????????

/** FRS???ID */
#define FRS_RECORDID_ACCELEROMETER          0xE302  // ????????
#define FRS_RECORDID_GYROSCOPE_CALIBRATED   0xE306  // У?????????
#define FRS_RECORDID_MAGNETIC_FIELD_CALIBRATED 0xE309  // У?????????
#define FRS_RECORDID_ROTATION_VECTOR        0xE30B  // ??????????

/** ????ID */
#define COMMAND_ERRORS         1   // ????????
#define COMMAND_COUNTER        2   // ??????????
#define COMMAND_TARE           3   // У?????
#define COMMAND_INITIALIZE     4   // ?????????
#define COMMAND_DCD            6   // ?????????????????
#define COMMAND_ME_CALIBRATE   7   // MEУ?????
#define COMMAND_DCD_PERIOD_SAVE 9  // ?????????DCD????
#define COMMAND_OSCILLATOR     10  // ????????
#define COMMAND_CLEAR_DCD      11  // ???DCD????

/** У???? */
#define CALIBRATE_ACCEL          0  // У???????
#define CALIBRATE_GYRO           1  // У???????
#define CALIBRATE_MAG            2  // У???????
#define CALIBRATE_PLANAR_ACCEL   3  // У?????????
#define CALIBRATE_ACCEL_GYRO_MAG 4  // У????????????????????
#define CALIBRATE_STOP           5  // ??У?

/**
  * @}
  */

/** @defgroup BNO080_Functions BNO080????????
  * @{
  */

/** ?????BNO080??????
  * @param hi2c I2C??????
  * @param address ?豸I2C?????7λ?????
  */
void BNO080_Init(I2C_HandleTypeDef *hi2c, uint8_t address);

/** 硬件复位BNO08X传感器，控制nRESET引脚进行硬件复位，等待Product ID Response */
int8_t BNO080_HardwareReset(void);

/** ?????????λ */
void softReset(void);

/** ?????λ???
  * @return ??λ??????
  */
uint8_t resetReason(void);

/** ???????????????????
  * @param fixedPointValue ????????
  * @param qPoint Q??λ??
  * @return ????????????
  */
float qToFloat(int16_t fixedPointValue, uint8_t qPoint);

/** ?????????????????
  * @return 1??????????0?????????
  */
uint8_t dataAvailable(void);

/** ?????????????? */
void parseInputReport(void);

/** ????????I???? */
float getQuatI(void);

/** ????????J???? */
float getQuatJ(void);

/** ????????K???? */
float getQuatK(void);

/** ??????????? */
float getQuatReal(void);

/** ??????????????? */
float getQuatRadianAccuracy(void);

/** ??????????????? */
uint8_t getQuatAccuracy(void);

/** ???X?????? */
float getAccelX(void);

/** ???Y?????? */
float getAccelY(void);

/** ???Z?????? */
float getAccelZ(void);

/** ?????????????? */
uint8_t getAccelAccuracy(void);

/** ???X?????????? */
float getLinAccelX(void);

/** ???Y?????????? */
float getLinAccelY(void);

/** ???Z?????????? */
float getLinAccelZ(void);

/** ????????????????? */
uint8_t getLinAccelAccuracy(void);

/** ???X???????????? */
float getGyroX(void);

/** ???Y???????????? */
float getGyroY(void);

/** ???Z???????????? */
float getGyroZ(void);

/** ??????????????? */
uint8_t getGyroAccuracy(void);

/** ???X??????????? */
float getMagX(void);

/** ???Y??????????? */
float getMagY(void);

/** ???Z??????????? */
float getMagZ(void);

/** ??????????????? */
uint8_t getMagAccuracy(void);

/** У??????? */
void calibrateAccelerometer(void);

/** У??????? */
void calibrateGyro(void);

/** У??????? */
void calibrateMagnetometer(void);

/** У????????? */
void calibratePlanarAccelerometer(void);

/** У????д????? */
void calibrateAll(void);

/** ????У????? */
void endCalibration(void);

/** ????У????? */
void saveCalibration(void);

/** ???????????
  * @return ???????
  */
uint16_t getStepCount(void);

/** ???????????
  * @return ???????
  */
uint8_t getStabilityClassifier(void);

/** ?????????
  * @return ??????
  */
uint8_t getActivityClassifier(void);

/** ?????????????????
  * @param reportID ????ID
  * @param timeBetweenReports ?????????????
  * @param specificConfig ??????ò???
  */
void setFeatureCommand(uint8_t reportID, uint32_t timeBetweenReports, uint32_t specificConfig);

/** ????????
  * @param command ????ID
  */
void sendCommand(uint8_t command);

/** ????У?????
  * @param thingToCalibrate ?У??????
  */
void sendCalibrateCommand(uint8_t thingToCalibrate);

/** ???FRS?????Q1?
  * @param recordID FRS???ID
  * @return Q1?
  */
int16_t getQ1(uint16_t recordID);

/** ???FRS?????Q2?
  * @param recordID FRS???ID
  * @return Q2?
  */
int16_t getQ2(uint16_t recordID);

/** ???FRS?????Q3?
  * @param recordID FRS???ID
  * @return Q3?
  */
int16_t getQ3(uint16_t recordID);

/** ??????????????
  * @param recordID FRS???ID
  * @return ??????????????
  */
float getResolution(uint16_t recordID);

/** ?????????????
  * @param recordID FRS???ID
  * @return ?????????????
  */
float getRange(uint16_t recordID);

/** ???FRS??????
  * @param recordID FRS???ID
  * @param wordNumber ????
  * @return ?????32λ????
  */
uint32_t readFRSword(uint16_t recordID, uint8_t wordNumber);

/** ??????FRS????
  * @param recordID FRS???ID
  * @param readOffset ????????
  * @param blockSize ??????С
  */
void frsReadRequest(uint16_t recordID, uint16_t readOffset, uint16_t blockSize);

/** ???FRS????
  * @param recordID FRS???ID
  * @param startLocation ???λ??
  * @param wordsToRead ??????????
  * @return 1????????0??????
  */
uint8_t readFRSdata(uint16_t recordID, uint8_t startLocation, uint8_t wordsToRead);

/** ???????????????
  * @param timeBetweenReports ?????????????
  */
void enableRotationVector(uint32_t timeBetweenReports);

/** ??????????????????
  * @param timeBetweenReports ?????????????
  */
void enableGameRotationVector(uint32_t timeBetweenReports);

/** ???ü????????
  * @param timeBetweenReports ?????????????
  */
void enableAccelerometer(uint32_t timeBetweenReports);

/** ????????????????
  * @param timeBetweenReports ?????????????
  */
void enableLinearAccelerometer(uint32_t timeBetweenReports);

/** ?????????????
  * @param timeBetweenReports ?????????????
  */
void enableGyro(uint32_t timeBetweenReports);

/** ????????????
  * @param timeBetweenReports ?????????????
  */
void enableMagnetometer(uint32_t timeBetweenReports);

/** ???ò?????????????
  * @param timeBetweenReports ?????????????
  */
void enableStepCounter(uint32_t timeBetweenReports);

/** ??????????????????
  * @param timeBetweenReports ?????????????
  */
void enableStabilityClassifier(uint32_t timeBetweenReports);

/** ???????????
  * @param ????
  */
void QuaternionToEulerAngles(float quatI, float quatJ, float quatK, float quatReal,
                            float *roll, float *pitch, float *yaw);

/** BNO080????????????????????ú???
  * @note ????????????????λ?????????????????????
  * @note ???????????????????ò?????????
  * @retval 0: ???, -1: ???
  */
int8_t my_bno080_init(void);

/** BNO080?????????????????????
  * @note ???????????????????50-100ms???????
  * @note ???????????????????ò?????????
  */
void bno080_task(void);

/**
  * @}
  */

#endif /* __BNO08X_HAL_H_ */
